<!-- Items Table -->
<div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-gray-50 dark:bg-gray-700">
            <tr>
                <!-- Item Name -->
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "item_name", "direction": "{{ 'desc' if current_sort == 'item_name' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Item Name</span>
                        <span class="flex-none">
                            {% if current_sort == 'item_name' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>

                <!-- SKU -->
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "sku", "direction": "{{ 'desc' if current_sort == 'sku' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>SKU</span>
                        <span class="flex-none">
                            {% if current_sort == 'sku' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>

                <!-- Description -->
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "description", "direction": "{{ 'desc' if current_sort == 'description' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Description</span>
                        <span class="flex-none">
                            {% if current_sort == 'description' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>

                <!-- Category -->
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "category", "direction": "{{ 'desc' if current_sort == 'category' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Category</span>
                        <span class="flex-none">
                            {% if current_sort == 'category' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>

                <!-- Price -->
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "price", "direction": "{{ 'desc' if current_sort == 'price' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Price</span>
                        <span class="flex-none">
                            {% if current_sort == 'price' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>

                <!-- Unit Cost -->
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                    Unit Cost
                </th>

                <!-- Vendor Name -->
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "vendor_name", "direction": "{{ 'desc' if current_sort == 'vendor_name' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Vendor</span>
                        <span class="flex-none">
                            {% if current_sort == 'vendor_name' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>

                <!-- Vendor Code -->
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">
                    Vendor Code
                </th>

                <!-- Profit Margin -->
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "profit_margin_percent", "direction": "{{ 'desc' if current_sort == 'profit_margin_percent' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Margin %</span>
                        <span class="flex-none">
                            {% if current_sort == 'profit_margin_percent' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>

                <!-- Total Quantity -->
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "total_qty", "direction": "{{ 'desc' if current_sort == 'total_qty' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Total Qty</span>
                        <span class="flex-none">
                            {% if current_sort == 'total_qty' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>

                <!-- Location Quantities -->
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "aubrey_qty", "direction": "{{ 'desc' if current_sort == 'aubrey_qty' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Aubrey Qty</span>
                        <span class="flex-none">
                            {% if current_sort == 'aubrey_qty' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "bridgefarmer_qty", "direction": "{{ 'desc' if current_sort == 'bridgefarmer_qty' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Bridgefarmer Qty</span>
                        <span class="flex-none">
                            {% if current_sort == 'bridgefarmer_qty' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "building_qty", "direction": "{{ 'desc' if current_sort == 'building_qty' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Building Qty</span>
                        <span class="flex-none">
                            {% if current_sort == 'building_qty' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "flomo_qty", "direction": "{{ 'desc' if current_sort == 'flomo_qty' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>FloMo Qty</span>
                        <span class="flex-none">
                            {% if current_sort == 'flomo_qty' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "justin_qty", "direction": "{{ 'desc' if current_sort == 'justin_qty' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Justin Qty</span>
                        <span class="flex-none">
                            {% if current_sort == 'justin_qty' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "quinlan_qty", "direction": "{{ 'desc' if current_sort == 'quinlan_qty' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Quinlan Qty</span>
                        <span class="flex-none">
                            {% if current_sort == 'quinlan_qty' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600"
                    hx-get="/items/table"
                    hx-target="#items-table"
                    hx-include="[name='search'], [name='category'], [name='vendor'], [name='item_type']"
                    hx-vals='{"sort": "terrell_qty", "direction": "{{ 'desc' if current_sort == 'terrell_qty' and current_direction == 'asc' else 'asc' }}"}'
                    hx-push-url="true">
                    <div class="flex items-center space-x-1">
                        <span>Terrell Qty</span>
                        <span class="flex-none">
                            {% if current_sort == 'terrell_qty' %}
                                {% if current_direction == 'asc' %}
                                    <i data-lucide="chevron-up" class="w-4 h-4"></i>
                                {% else %}
                                    <i data-lucide="chevron-down" class="w-4 h-4"></i>
                                {% endif %}
                            {% else %}
                                <i data-lucide="chevrons-up-down" class="w-4 h-4 opacity-50"></i>
                            {% endif %}
                        </span>
                    </div>
                </th>
            </tr>
        </thead>
        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
            {% if items %}
                {% for item in items %}
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
                    <!-- Item Name -->
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">
                        {{ item.item_name }}
                    </td>

                    <!-- SKU -->
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {% if item.sku %}
                            <span class="font-mono">{{ item.sku }}</span>
                        {% else %}
                            <span class="text-gray-400">No SKU</span>
                        {% endif %}
                    </td>

                    <!-- Description -->
                    <td class="px-6 py-4 text-sm text-gray-500 dark:text-gray-300 max-w-xs">
                        <div class="truncate" title="{{ item.description or 'No description' }}">
                            {% if item.description %}
                                {{ item.description[:100] }}{% if item.description|length > 100 %}...{% endif %}
                            {% else %}
                                <span class="text-gray-400 italic">No description</span>
                            {% endif %}
                        </div>
                    </td>

                    <!-- Category -->
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {% if item.category %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-200">
                                {{ item.category }}
                            </span>
                        {% else %}
                            <span class="text-gray-400 italic">No category</span>
                        {% endif %}
                    </td>

                    <!-- Price -->
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white font-medium">
                        {% if item.price %}
                            ${{ "%.2f"|format(item.price) }}
                        {% else %}
                            <span class="text-gray-400">-</span>
                        {% endif %}
                    </td>

                    <!-- Unit Cost -->
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {% if item.cost %}
                            ${{ "%.2f"|format(item.cost) }}
                        {% else %}
                            <span class="text-gray-400">-</span>
                        {% endif %}
                    </td>

                    <!-- Vendor Name -->
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {{ item.vendor_name or '-' }}
                    </td>

                    <!-- Vendor Code -->
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {% if item.vendor_code %}
                            <span class="font-mono">{{ item.vendor_code }}</span>
                        {% else %}
                            <span class="text-gray-400">-</span>
                        {% endif %}
                    </td>

                    <!-- Profit Margin -->
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {% if item.profit_margin_percent %}
                            <span class="{% if item.profit_margin_percent > 50 %}text-green-600 dark:text-green-400{% elif item.profit_margin_percent > 25 %}text-yellow-600 dark:text-yellow-400{% else %}text-red-600 dark:text-red-400{% endif %}">
                                {{ item.profit_margin_percent }}%
                            </span>
                        {% else %}
                            <span class="text-gray-400">-</span>
                        {% endif %}
                    </td>

                    <!-- Total Quantity -->
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {{ item.total_qty }}
                    </td>

                    <!-- Location Quantities -->
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {{ item.aubrey_qty }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {{ item.bridgefarmer_qty }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {{ item.building_qty }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {{ item.flomo_qty }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {{ item.justin_qty }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {{ item.quinlan_qty }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                        {{ item.terrell_qty }}
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="15" class="px-6 py-12 text-center text-sm text-gray-500 dark:text-gray-400">
                        {% if error %}
                            <div class="text-red-600 dark:text-red-400">{{ error }}</div>
                        {% else %}
                            No items found matching your criteria.
                        {% endif %}
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<!-- Table Footer with Summary -->
{% if items %}
<div class="px-6 py-3 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600">
    <div class="flex justify-between items-center text-sm text-gray-600 dark:text-gray-400">
        <div>
            Showing {{ total_items }} items
        </div>
        <div class="flex space-x-4">
            <button 
                type="button"
                class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200"
                onclick="exportItems('xlsx')"
            >
                <i data-lucide="download" class="w-4 h-4 inline mr-1"></i>
                Export Excel
            </button>
            <button 
                type="button"
                class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200"
                onclick="exportItems('csv')"
            >
                <i data-lucide="file-text" class="w-4 h-4 inline mr-1"></i>
                Export CSV
            </button>
        </div>
    </div>
</div>
{% endif %}

<script>
function exportItems(format) {
    // Get current filter values
    const search = document.getElementById('global-search').value;
    const category = document.getElementById('category-filter').value;
    const vendor = document.getElementById('vendor-filter').value;
    const itemType = document.getElementById('item-type-filter').value;
    
    // Build export URL with current filters
    const params = new URLSearchParams();
    if (search) params.append('search', search);
    if (category) params.append('category', category);
    if (vendor) params.append('vendor', vendor);
    if (itemType) params.append('item_type', itemType);
    params.append('format', format);
    
    // Open export URL
    window.open(`/items/export?${params.toString()}`, '_blank');
}
</script> 